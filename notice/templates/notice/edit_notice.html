{% extends 'core/base.html' %}
{% load form_tags %}
{% block page_title %}Edit Notice - {{ app_name }}{% endblock %}
{% block content %}
<div class="container">
    <h2>Edit Notice</h2>
    <form method="post" enctype="multipart/form-data" class="mt-3">
        {% csrf_token %}
        <div class="row">
            <div class="col-md-6 mb-3">
                {{ form.title.label_tag }}
                {{ form.title }}
                {% if form.title.help_text %}<small class="form-text text-muted">{{ form.title.help_text }}</small>{% endif %}
                {% if form.title.errors %}<div class="text-danger">{{ form.title.errors.0 }}</div>{% endif %}
            </div>
            <div class="col-md-6 mb-3">
                {{ form.priority.label_tag }}
                {{ form.priority }}
                {% if form.priority.help_text %}<small class="form-text text-muted">{{ form.priority.help_text }}</small>{% endif %}
                {% if form.priority.errors %}<div class="text-danger">{{ form.priority.errors.0 }}</div>{% endif %}
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 mb-3">
                {{ form.content.label_tag }}
                {{ form.content }}
                {% if form.content.help_text %}<small class="form-text text-muted">{{ form.content.help_text }}</small>{% endif %}
                {% if form.content.errors %}<div class="text-danger">{{ form.content.errors.0 }}</div>{% endif %}
            </div>
        </div>
        <div class="row">
            <div class="col-md-4 mb-3">
                {{ form.audience.label_tag }}
                {{ form.audience }}
                {% if form.audience.help_text %}<small class="form-text text-muted">{{ form.audience.help_text }}</small>{% endif %}
                {% if form.audience.errors %}<div class="text-danger">{{ form.audience.errors.0 }}</div>{% endif %}
            </div>
            <div class="col-md-4 mb-3">
                {{ form.iwi.label_tag }}
                {{ form.iwi }}
                {% if form.iwi.help_text %}<small class="form-text text-muted">{{ form.iwi.help_text }}</small>{% endif %}
                {% if form.iwi.errors %}<div class="text-danger">{{ form.iwi.errors.0 }}</div>{% endif %}
            </div>
            <div class="col-md-4 mb-3">
                {{ form.hapu.label_tag }}
                {{ form.hapu }}
                {% if form.hapu.help_text %}<small class="form-text text-muted">{{ form.hapu.help_text }}</small>{% endif %}
                {% if form.hapu.errors %}<div class="text-danger">{{ form.hapu.errors.0 }}</div>{% endif %}
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 mb-3">
                {{ form.expiry_date.label_tag }}
                {{ form.expiry_date }}
                {% if form.expiry_date.help_text %}<small class="form-text text-muted">{{ form.expiry_date.help_text }}</small>{% endif %}
                {% if form.expiry_date.errors %}<div class="text-danger">{{ form.expiry_date.errors.0 }}</div>{% endif %}
            </div>
            <div class="col-md-6 mb-3">
                {{ form.attachment.label_tag }}
                {{ form.attachment }}
                {% if form.attachment.help_text %}<small class="form-text text-muted">{{ form.attachment.help_text }}</small>{% endif %}
                {% if form.attachment.errors %}<div class="text-danger">{{ form.attachment.errors.0 }}</div>{% endif %}
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Update Notice</button>
                        <a href="{% url 'notice:manage_notices' %}" class="btn btn-secondary ms-2">Cancel</a>
    </form>
</div>
{% endblock %}
{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    function updateIwiHapuFields() {
      const audience = document.getElementById('id_audience');
      const iwi = document.getElementById('id_iwi');
      const hapu = document.getElementById('id_hapu');
      if (!audience || !iwi || !hapu) return;
      if (audience.value === 'ALL') {
        iwi.disabled = true;
        hapu.disabled = true;
      } else if (audience.value === 'IWI') {
        iwi.disabled = false;
        hapu.disabled = true;
      } else if (audience.value === 'HAPU') {
        iwi.disabled = false;
        hapu.disabled = false;
      }
    }
    const audience = document.getElementById('id_audience');
    if (audience) {
      audience.addEventListener('change', updateIwiHapuFields);
      updateIwiHapuFields();
    }
  });
</script>
{% endblock %} 